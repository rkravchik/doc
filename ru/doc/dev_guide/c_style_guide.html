






















<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google-site-verification" content="CR40jzpLISkiUAw2MrH2zHSDNVmzyK88Nj7Crmx_RxQ" />
    
  <link rel="icon" type="image/png" sizes="16x16" href=../../_static/favicon/favicon-16x16.png>
  <link rel="icon" type="image/png" sizes="32x32" href=../../_static/favicon/favicon-32x32.png>
  <link rel="icon" type="image/png" sizes="96x96" href=../../_static/favicon/favicon-96x96.png>

    <title>4.3. C Style Guide</title>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="../../_static/searchtools.js"></script>
      <script type="text/javascript" src="../../_static/js/menu.js"></script>
      <script type="text/javascript" src="../../_static/js/mobile_menu.js"></script>
      <script type="text/javascript" src="../../_static/js/stacktable.min.js"></script>
      <script type="text/javascript" src="../../_static/js/headers.js"></script>
      <script type="text/javascript" src="../../_static/js/dropdown.js"></script>
      <script type="text/javascript" src="../../_static/js/jquery.sticky-kit.min.js"></script>
      <link rel="stylesheet" href="../../_static/design.css">

    
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.3',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          this.page.identifier = "doc/dev_guide/c_style_guide";
          this.language        = "ru"
      };
      window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = []; t.ready = function(f) { t._e.push(f); };
        return t;
      }(document, "script", "twitter-wjs"));
    </script>
    

  </head>
  <body class="p-cols_design b-doc-doc_dev_guide_c_style_guide">
    <div class="b-wrapper">
      <!-- HEADER > -->
      
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search"
            action="../../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

        </nav>
      </div>
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        <div class="b-header_menu-top">
          
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

          <div class="b-header_menu-top-ctl">
            
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../../en/doc/dev_guide/c_style_guide.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>

            <button class="b-search-btn"> <i class="fa fa-search fa-2x"></i> </button>
          </div>
        </div>
        <div class="b-header_menu-bottom">
          <form role="search" class="b-header_menu-search" action="../../search.html" method="get">
            <input name="q" type="search" class="b-header_menu-search-text" placeholder="Search">
            <input class="b-header_menu-search-but" type="submit" value="Search">
          </form>
        </div>
      </nav>
    </div>
  </header>

      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  
    <section class="b-block-lightgray b-documentation_top b-clearbox p-documentation_in">
      <div class="b-block-wrapper">
        <h2 class="b-section-title b-ellipsis toggle-navigation" title="4.3. C Style Guide"> 4.3. C Style Guide </h2>
      </div>
    </section>
    
      <div class="b-cols_content b-clearbox">
        <div class="b-cols_content_left">
          <div class="b-menu-toc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">Что нового?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whats_new.html#what-s-new-in-tarantool-1-7">Что нового в Tarantool 1.7?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Общие сведения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#an-application-server-together-with-a-database-manager">Сервер приложений + СУБД</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#database-features">Возможности СУБД</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../book/index.html">Руководство пользователя</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../book/intro.html">1. Предисловие</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/intro.html#how-to-read-the-documentation">1.1. Как пользоваться документацией</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/intro.html#getting-in-touch-with-the-tarantool-community">1.2. Как связаться с сообществом разработчиков Tarantool&#8217;а</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/user_guide_getting_started.html">2. Начало работы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Скачивание и установка бинарного пакета</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Первичный запуск Tarantool&#8217;а и создание базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/user_guide_getting_started.html#connecting-remotely">2.3. Установка удаленного соединения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/box/index.html">3. Функционал СУБД</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/box/data_model.html">3.1. Модель данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#space">3.1.1. Пространство</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#tuple">3.1.2. Tuple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#index">3.1.3. Индекс</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#data-types">3.1.4. Типы данных</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/data_model.html#lua-vs-msgpack">3.1.4.1. Lua vs MsgPack</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/data_model.html#indexed-field-types">3.1.4.2. Indexed field types</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#persistence">3.1.5. Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/data_model.html#operations">3.1.6. Операции</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/data_model.html#data-operations">3.1.6.1. Data operations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/data_model.html#index-operations">3.1.6.2. Операции с индексами</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/data_model.html#complexity-factors">3.1.6.3. Complexity factors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/atomic.html">3.2. Контроль транзакций</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/atomic.html#threads-fibers-and-yields">3.2.1. Threads, fibers and yields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/atomic.html#cooperative-multitasking">3.2.2. Cooperative multitasking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/atomic.html#transactions">3.2.3. Transactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/atomic.html#implicit-yields">3.2.4. Implicit yields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/authentication.html">3.3. Ограничение доступа</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/authentication.html#users">3.3.1. Users</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/authentication.html#passwords">3.3.2. Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/authentication.html#owners-and-privileges">3.3.3. Owners and privileges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/authentication.html#roles">3.3.4. Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/authentication.html#sessions-and-security">3.3.5. Sessions and security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/triggers.html">3.4. Триггеры</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/box/limitations.html">3.5. Ограничения</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/app_server.html">4. Сервер приложений</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#about-modules-rocks">4.1. Про модули/rocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#installing-an-existing-module">4.2. Установка существующего модуля</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-new-lua-module-locally">4.3. Создание нового модуля на языке Lua</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-new-c-c-module-locally">4.4. Создание нового модуля на языке C/C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#creating-a-mixed-lua-c-module-locally">4.5. Создание нового модуля на смеси языков Lua/C</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#tips-for-special-situations">4.6. Примечания для особых случаев</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#tips-on-lua-syntax">4.7. Tips on Lua syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/app_server.html#cookbook-recipes">4.8. Книга рецептов</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#hello-world-lua">4.8.1. hello_world.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#console-start-lua">4.8.2. console_start.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#fio-read-lua">4.8.3. fio_read.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#fio-write-lua">4.8.4. fio_write.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#ffi-printf-lua">4.8.5. ffi_printf.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#ffi-gettimeofday-lua">4.8.6. ffi_gettimeofday.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#ffi-zlib-lua">4.8.7. ffi_zlib.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#ffi-meta-lua">4.8.8. ffi_meta.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#print-arrays-lua">4.8.9. print_arrays.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#count-array-lua">4.8.10. count_array.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#count-array-with-nils-lua">4.8.11. count_array_with_nils.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#count-array-with-nulls-lua">4.8.12. count_array_with_nulls.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#count-map-lua">4.8.13. count_map.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#swap-lua">4.8.14. swap.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#uri-lua">4.8.15. uri.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#class-lua">4.8.16. class.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#garbage-lua">4.8.17. garbage.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#fiber-producer-and-consumer-lua">4.8.18. fiber_producer_and_consumer.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#socket-tcpconnect-lua">4.8.19. socket_tcpconnect.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#socket-tcp-echo-lua">4.8.20. socket_tcp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#getaddrinfo-lua">4.8.21. getaddrinfo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#socket-udp-echo-lua">4.8.22. socket_udp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#http-get-lua">4.8.23. http_get.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#http-send-lua">4.8.24. http_send.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#http-server-lua">4.8.25. http_server.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/app_server.html#http-generate-html-lua">4.8.26. http_generate_html.lua</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/administration.html">5. Администрирование серверной части</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#using-tarantool-as-a-client">5.1. Using Tarantool as a client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#conventions-used-in-this-section">5.1.1. Условные обозначения, используемые в этом разделе</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#options-when-starting-client-from-the-command-line">5.1.2. Параметры запуска клиента из командной строки</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#tokens-requests-and-special-key-combinations">5.1.3. Токены, запросы и специальные комбинации клавиш</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#requests">5.1.4. Запросы</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#utility-tarantoolctl">5.2. Утилита tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#configuration-for-tarantoolctl">5.2.1. Конфигурирование tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#commands-for-tarantoolctl">5.2.2. Команды для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#typical-code-snippets-for-tarantoolctl">5.2.3. Примеры кода для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#a-detailed-example-for-tarantoolctl">5.2.4. Подробный пример для tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#an-example-for-tarantoolctl-connect">5.2.5. An example for tarantoolctl connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#administrative-ports">5.3. Служебные порты</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#administrative-requests">5.4. Служебные запросы</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#server-introspection">5.5. Просмотр состояния сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#backups">5.6. Резервное копирование</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#cold-backup">5.6.1. Cold backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#continuous-remote-backup">5.6.2. Continuous remote backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#hot-backup">5.6.3. Hot backup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#updates-upgrades">5.7. Обновление сервера и базы данных</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#updating-tarantool-in-production">5.7.1. Обновление Tarantool&#8217;а в условиях эксплуатации</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#upgrading-a-tarantool-database">5.7.2. Upgrading a Tarantool database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#server-signal-handling">5.8. Обработка сигналов от сервера</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#generating-a-core-file">5.9. Generating a core file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#process-title">5.10. Название процесса</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#system-specific-administration-notes">5.11. Заметки по администрированию для разных платформ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#debian-gnu-linux-and-ubuntu">5.11.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#fedora-rhel-centos">5.11.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#freebsd">5.11.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#mac-os-x">5.11.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/administration.html#notes-for-systemd-users">5.12. Заметки для пользователей systemd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#instance-management">5.12.1. Управление экземплярами</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#creating-instances">5.12.1.1. Создание экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#starting-instances">5.12.1.2. Запуск экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#monitoring-instances">5.12.1.3. Мониторинг экземпляров</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#attaching-to-instances">5.12.1.4. Подсоединение к экземплярам</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#checking-logs">5.12.1.5. Проверка журнала</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/administration.html#stopping-instances">5.12.1.6. Остановка экземпляров</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#daemon-supervision">5.12.2. Контроль за фоновыми программами</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#customizing-the-service-file">5.12.3. Правка настроек сервисного файла</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#debugging">5.12.4. Отладка</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#precautions">5.12.5. Особые указания</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#limitations">5.12.6. Ограничения</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/administration.html#sysvinit-systemd-conversion">5.12.7. sysvinit -&gt; systemd conversion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/replication/index.html">6. Репликация</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#replication-architecture">6.1. Архитектура механизма репликации</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#setting-up-a-master">6.2. Setting up a master</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#setting-up-a-replica">6.3. Настройка сервера-реплики</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#recovering-from-a-degraded-state">6.4. Восстановление после сбоя</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#quick-startup-of-a-new-simple-two-server-cluster">6.5. Quick startup of a new simple two-server cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#monitoring-a-replica-s-actions">6.6. Мониторинг действий реплики</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#preventing-duplicate-actions">6.7. Предотвращение дублирующихся действий</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#master-master-replication">6.8. Репликация по схеме master-master</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#all-the-what-if-questions">6.9. Ответы на вопросы &#8220;Что если?&#8221;</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/replication/index.html#hands-on-replication-tutorial">6.10. Практическое руководство по репликации</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/connectors/index.html">7. Коннекторы</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#protocol">7.1. Протокол</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#packet-example">7.2. Пример пакета данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#setting-up-the-server-for-connector-examples">7.3. Настройка окружения для примеров работы с коннекторами</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#java">7.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#go">7.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#r">7.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#erlang">7.7. Erlang</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#perl">7.8. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#php">7.9. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#python">7.10. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#node-js">7.11. Node.js</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#c">7.12. C#</a></li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#id1">7.13. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/connectors/index.html#example-1">7.13.1. Пример 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/connectors/index.html#example-2">7.13.2. Пример 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../book/connectors/index.html#interpreting-function-return-values">7.14. Интерпретация возвращаемых значений</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../book/faq.html">8. Вопросы и ответы</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Справочники</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_lua/index.html">1. Справочник по встроенной библиотеке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box.html">1.1. Модуль <cite>box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_cfg.html">1.1.1. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_index.html">1.1.2. Вложенный модуль <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#example-showing-use-of-the-box-functions">1.1.2.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#example-showing-a-user-defined-iterator">1.1.2.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">1.1.2.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_info.html">1.1.3. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/box_once.html">1.1.4. Функция <cite>box.once</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_schema.html">1.1.5. Вложенный модуль <cite>box.schema</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_session.html">1.1.6. Вложенный модуль <cite>box.session</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_slab.html">1.1.7. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_space.html">1.1.8. Вложенный модуль <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_space.html#example-use-box-space-functions-to-read-space-tuples">1.1.8.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">1.1.8.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_stat.html">1.1.9. Submodule <cite>box.stat</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_tuple.html">1.1.10. Вложенный модуль <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../book/box/box_tuple.html#example">1.1.10.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../book/box/box_txn_management.html">1.1.11. Functions for transaction management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/clock.html">1.2. Модуль <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/console.html">1.3. Модуль <cite>console</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/crypto.html">1.4. Модуль <cite>crypto</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#incremental-methods-in-the-crypto-module">1.4.1. Incremental methods in the crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">1.4.2. Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/csv.html">1.5. Module <cite>csv</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/digest.html">1.6. Модуль <cite>digest</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#incremental-methods-in-the-digest-module">1.6.1. Incremental methods in the digest module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#example">1.6.2. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errno.html">1.7. Module <cite>errno</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_error.html">1.8. Вложенный модуль <cite>box.error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber.html">1.9. Модуль <cite>fiber</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber.html#example-of-fiber-use">1.9.1. Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html">1.10. Модуль <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#channel">1.10.1. Channel</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#example">1.10.1.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#condition-variables">1.10.2. Condition variables</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#id1">1.10.2.1. Пример</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fio.html">1.11. Module <cite>fio</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-pathname-manipulations">1.11.1. Common pathname manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-file-manipulations">1.11.2. Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fun.html">1.12. Module <cite>fun</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/json.html">1.13. Module <cite>json</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/json.html#configuration-settings">1.13.1. Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/log.html">1.14. Module <cite>log</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/log.html#example">1.14.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/msgpack.html">1.15. Модуль <cite>msgpack</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/msgpack.html#example">1.15.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/net_box.html">1.16. Модуль <cite>net.box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/net_box.html#example">1.16.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/pickle.html">1.17. Модуль <cite>pickle</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/socket.html">1.18. Модуль <cite>socket</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/socket.html#examples">1.18.1. Примеры:</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">1.18.1.1. Use of a TCP socket over the Internet</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-udp-socket-on-localhost">1.18.1.2. Use of a UDP socket on localhost</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">1.18.1.3. Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/strict.html">1.19. Модуль <cite>strict</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tap.html">1.20. Module <cite>tap</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/tap.html#example">1.20.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tarantool.html">1.21. Модуль <cite>tarantool</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/uuid.html">1.22. Module <cite>uuid</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/uuid.html#example">1.22.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/xlog.html">1.23. Module <cite>xlog</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/yaml.html">1.24. Module <cite>yaml</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/yaml.html#example">1.24.1. Пример</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/other.html">1.25. Разное</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errcodes.html">1.26. Коды ошибок от базы данных</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errcodes.html#handling-errors">1.27. Handling errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_rock/index.html">2. Справочник по сторонним библиотекам</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/dbms.html">2.1. SQL DBMS Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#mysql-example">2.1.1. MySQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#installation">2.1.1.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-luarocks">2.1.1.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-github">2.1.1.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#connecting">2.1.1.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#how-to-ping">2.1.1.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#executing-a-statement">2.1.1.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#closing-connection">2.1.1.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#example">2.1.1.6. Пример</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#postgresql-example">2.1.2. PostgreSQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id1">2.1.2.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id2">2.1.2.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id3">2.1.2.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id4">2.1.2.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id5">2.1.2.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id6">2.1.2.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id7">2.1.2.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id8">2.1.2.6. Пример</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/expirationd.html">2.2. Модуль <cite>expirationd</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/shard.html">2.3. Модуль <cite>shard</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-one-shard">2.3.1. Example: shard.init syntax for one shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-three-shards">2.3.2. Example: shard.init syntax for three shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-minimal-configuration">2.3.3. Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-scaling-out">2.3.4. Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/tdb.html">2.4. Module <cite>tdb</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#debugger-commands">2.4.1. Debugger Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#example-session">2.4.2. Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration/index.html">3. Справочник по настройке</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#command-options">3.1. Опции комнандной строки</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#uri">3.2. Универсальный код ресурса (URI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#initialization-file">3.3. Файл инициализации</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#configuration-parameters">3.4. Параметры конфигурации</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#basic-parameters">3.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#configuring-the-storage">3.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#snapshot-daemon">3.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#binary-logging-and-snapshots">3.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#hot-standby">3.4.5. Hot standby</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#replication">3.4.6. Репликация</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#networking">3.4.7. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#logging">3.4.8. Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Практикум</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/lua_tutorials.html">1. Практические задания на Lua</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#insert-one-million-tuples-with-a-lua-stored-procedure">1.1. Вставка 1 млн кортежей с помощью хранимой процедуры на языке Lua</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#configure">1.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#delimiter">1.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-returns-a-string">1.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-calls-another-function-and-sets-a-variable">1.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-one-letter-random-string">1.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-ten-letter-random-string">1.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#make-a-tuple-out-of-a-number-and-a-string">1.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-tuple-into-the-database">1.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-million-tuples-into-the-database">1.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#sum-a-json-field-for-all-tuples">1.2. Подсчет суммы по JSON-полям во всех кортежах</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#indexed-pattern-search">1.3. Индексированный поиск по шаблонам</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/c_tutorial.html">2. Практическое задание на C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/c_tutorial.html#c-stored-procedures">2.1. Хранимые процедуры на языке C</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="reference_capi/index.html">1. Справочник по C API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/box.html">1.1. Модуль <cite>box</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/clock.html">1.2. Модуль <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/coio.html">1.3. Модуль <cite>coio</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/error.html">1.4. Модуль <cite>error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/fiber.html">1.5. Модуль <cite>fiber</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/box_index.html">1.6. Модуль <cite>index</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/latch.html">1.7. Модуль <cite>latch</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/utils.html">1.8. Модуль <cite>lua/utils</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/say.html">1.9. Модуль <cite>say</cite> (логирование)</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/schema.html">1.10. Модуль <cite>schema</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/trivia.html">1.11. Модуль <cite>trivia/config</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/tuple.html">1.12. Модуль <cite>tuple</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="reference_capi/txn.html">1.13. Модуль <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="internals_index.html">2. Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="internals_index.html#tarantool-s-binary-protocol">2.1. Tarantool&#8217;s binary protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#notation-in-diagrams">2.1.1. Notation in diagrams</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#greeting-packet">2.1.2. Greeting packet</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#unified-packet-structure">2.1.3. Unified packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#authentication">2.1.4. Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#requests">2.1.5. Запросы</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#response-packet-structure">2.1.6. Response packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#replication-packet-structure">2.1.7. Replication packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="internals_index.html#xlog-snap">2.1.8. XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="internals_index.html#data-persistence-and-the-wal-file-format">2.2. Data persistence and the WAL file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals_index.html#the-snapshot-file-format">2.3. The snapshot file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals_index.html#the-recovery-process">2.4. The recovery process</a></li>
<li class="toctree-l3"><a class="reference internal" href="internals_index.html#server-startup-with-replication">2.5. Server startup with replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_contribute_index.html">3. Build and contribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html">3.1. Building from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_documentation.html">3.2. Building documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="release_management.html">3.3. Release management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="release_management.html#how-to-make-a-minor-release">3.3.1. How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="guidelines_index.html">4. Guidelines</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="developer_guidelines.html">4.1. Developer guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="developer_guidelines.html#how-to-work-on-a-bug">4.1.1. How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="documentation_guidelines.html">4.2. Documentation guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#markup-issues">4.2.1. Markup issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#wrapping-text">4.2.1.1. Wrapping text</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#formatting-code-snippets">4.2.1.2. Formatting code snippets</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#using-separated-links">4.2.1.3. Using separated links</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#creating-labels-for-local-links">4.2.1.4. Creating labels for local links</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#making-comments">4.2.1.5. Making comments</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#language-and-style-issues">4.2.2. Language and style issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#us-vs-british-spelling">4.2.2.1. US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="documentation_guidelines.html#examples-and-templates">4.2.3. Examples and templates</a><ul>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#module-and-function">4.2.3.1. Module and function</a></li>
<li class="toctree-l5"><a class="reference internal" href="documentation_guidelines.html#module-class-and-method">4.2.3.2. Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.3. C Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-guidelines">4.3.1. General guidelines</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#commenting-style">4.3.1.1. Commenting style</a></li>
<li class="toctree-l5"><a class="reference internal" href="#header-files">4.3.1.2. Header files</a></li>
<li class="toctree-l5"><a class="reference internal" href="#allocating-memory">4.3.1.3. Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="#other">4.3.1.4. Other</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#linux-kernel-coding-style">4.3.2. Linux kernel coding style</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#chapter-1-indentation">4.3.2.1. Chapter 1: Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-2-breaking-long-lines-and-strings">4.3.2.2. Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-3-placing-braces-and-spaces">4.3.2.3. Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-3-1-spaces">4.3.2.4. Chapter 3.1:  Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-4-naming">4.3.2.5. Chapter 4: Naming</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-5-typedefs">4.3.2.6. Chapter 5: Typedefs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-6-functions">4.3.2.7. Chapter 6: Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-7-centralized-exiting-of-functions">4.3.2.8. Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-8-commenting">4.3.2.9. Chapter 8: Commenting</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-9-you-ve-made-a-mess-of-it">4.3.2.10. Chapter 9: You&#8217;ve made a mess of it</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-10-kconfig-configuration-files">4.3.2.11. Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-11-data-structures">4.3.2.12. Chapter 11: Data structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-12-macros-enums-and-rtl">4.3.2.13. Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-13-printing-kernel-messages">4.3.2.14. Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-14-allocating-memory">4.3.2.15. Chapter 14: Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-15-the-inline-disease">4.3.2.16. Chapter 15: The inline disease</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-16-function-return-values-and-names">4.3.2.17. Chapter 16: Function return values and names</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-17-don-t-re-invent-the-kernel-macros">4.3.2.18. Chapter 17:  Don&#8217;t re-invent the kernel macros</a></li>
<li class="toctree-l5"><a class="reference internal" href="#chapter-18-editor-modelines-and-other-cruft">4.3.2.19. Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l5"><a class="reference internal" href="#appendix-i-references">4.3.2.20. Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python_style_guide.html">4.4. Python Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#introduction">4.4.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">4.4.2. A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#code-lay-out">4.4.3. Code lay-out</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#indentation">4.4.3.1. Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#tabs-or-spaces">4.4.3.2. Tabs or Spaces?</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#maximum-line-length">4.4.3.3. Maximum Line Length</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#blank-lines">4.4.3.4. Blank Lines</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#encodings-pep-263">4.4.3.5. Encodings (PEP 263)</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#imports">4.4.3.6. Imports</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#whitespace-in-expressions-and-statements">4.4.4. Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#pet-peeves">4.4.4.1. Pet Peeves</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#other-recommendations">4.4.4.2. Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#comments">4.4.5. Comments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#block-comments">4.4.5.1. Block Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#inline-comments">4.4.5.2. Inline Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#documentation-strings">4.4.5.3. Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#version-bookkeeping">4.4.6. Version Bookkeeping</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#naming-conventions">4.4.7. Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#descriptive-naming-styles">4.4.7.1. Descriptive: Naming Styles</a></li>
<li class="toctree-l5"><a class="reference internal" href="python_style_guide.html#prescriptive-naming-conventions">4.4.7.2. Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#names-to-avoid">4.4.7.2.1. Names to Avoid</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#package-and-module-names">4.4.7.2.2. Package and Module Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#class-names">4.4.7.2.3. Class Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#exception-names">4.4.7.2.4. Exception Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#global-variable-names">4.4.7.2.5. Global Variable Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#function-names">4.4.7.2.6. Function Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#function-and-method-arguments">4.4.7.2.7. Function and method arguments</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#method-names-and-instance-variables">4.4.7.2.8. Method Names and Instance Variables</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#constants">4.4.7.2.9. Constants</a></li>
<li class="toctree-l6"><a class="reference internal" href="python_style_guide.html#designing-for-inheritance">4.4.7.2.10. Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#references">4.4.8. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="python_style_guide.html#copyright">4.4.9. Copyright</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
        <div class="b-cols_content_right">
          <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="index.html"
             class="b-path-list-item-url b-ellipsis">
            Contributor&#8217;s Guide
          </a>
        </li>
      
        <li class="b-path-list-item">
          <a href="guidelines_index.html"
             class="b-path-list-item-url b-ellipsis">
            4. Guidelines
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="4.3. C Style Guide" class="b-path_current b-ellipsis">
          4.3. C Style Guide
        </div>
      </li>
      
    </ul>
  </div>

  <article class="b-article">
    
    
      <div class="admonition note">
        <p class="first admonition-title">Замечание</p>
        <p class="last">
          Документация находится в процессе перевода и может
          отставать от Английской версии
        </p>
      </div>
    
    <div class="section" id="c-style-guide">
<h1>4.3. C Style Guide<a class="headerlink" href="#c-style-guide" title="Ссылка на этот заголовок">¶</a></h1>
<p>The project&#8217;s coding style is based on a version of the Linux kernel coding style.</p>
<p>The latest version of the Linux style can be found at:
<a class="reference external" href="http://www.kernel.org/doc/Documentation/CodingStyle">http://www.kernel.org/doc/Documentation/CodingStyle</a></p>
<p>Since it is open for changes, the version of style that we follow,
one from 2007-July-13, will be also copied later in this document.</p>
<p>There are a few additional guidelines, either unique
to Tarantool or deviating from the Kernel guidelines.</p>
<ol class="upperalpha simple">
<li>Chapters 10 &#8220;Kconfig configuration files&#8221;, 11 &#8220;Data structures&#8221;,
13 &#8220;Printing kernel messages&#8221;, 14 &#8220;Allocating memory&#8221; and 17
&#8220;Don&#8217;t re-invent the kernel macros&#8221; do not apply, since they are
specific to Linux kernel programming environment.</li>
<li>The rest of Linux Kernel Coding Style is amended as follows:</li>
</ol>
<div class="section" id="general-guidelines">
<h2>4.3.1. General guidelines<a class="headerlink" href="#general-guidelines" title="Ссылка на этот заголовок">¶</a></h2>
<p>We use Git for revision control. The latest development is happening in the
&#8216;master&#8217; branch. Our git repository is hosted on github, and can be checked
out with git clone git://github.com/tarantool/tarantool.git # anonymous read-only access</p>
<p>If you have any questions about Tarantool internals, please post them on the
developer discussion list, <a class="reference external" href="https://groups.google.com/forum/#!forum/tarantool">https://groups.google.com/forum/#!forum/tarantool</a>. However,
please be warned: Launchpad silently deletes posts from non-subscribed members,
thus please be sure to have subscribed to the list prior to posting. Additionally,
some engineers are always present on #tarantool channel on irc.freenode.net.</p>
<div class="section" id="commenting-style">
<h3>4.3.1.1. Commenting style<a class="headerlink" href="#commenting-style" title="Ссылка на этот заголовок">¶</a></h3>
<p>Use Doxygen comment format, Javadoc flavor, i.e. <cite>&#64;tag</cite> rather than <cite>tag</cite>.
The main tags in use are &#64;param, &#64;retval, &#64;return, &#64;see, &#64;note and &#64;todo.</p>
<p>Every function, except perhaps a very short and obvious one, should have a
comment. A sample function comment may look like below:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/** Write all data to a descriptor.
 *
 * This function is equivalent to &#39;write&#39;, except it would ensure
 * that all data is written to the file unless a non-ignorable
 * error occurs.
 *
 * @retval 0  Success
 *
 * @reval  1  An error occurred (not EINTR)
 * /
static int
write_all(int fd, void \*data, size_t len);
</pre></div>
</div>
<p>Public structures and important structure members should be commented as well.</p>
</div>
<div class="section" id="header-files">
<h3>4.3.1.2. Header files<a class="headerlink" href="#header-files" title="Ссылка на этот заголовок">¶</a></h3>
<p>Use header guards. Put the header guard in the first line in the header,
before the copyright or declarations. Use all-uppercase name for the header
guard. Derive the header guard name from the file name, and append _INCLUDED
to get a macro name. For example, core/log_io.h -&gt; CORE_LOG_IO_H_INCLUDED. In
<code class="docutils literal"><span class="pre">.c</span></code> (implementation) file, include the respective declaration header before all
other headers, to ensure that the header is self- sufficient. Header &#8220;header.h&#8221;
is self-sufficient if the following compiles without errors:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;header.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="allocating-memory">
<h3>4.3.1.3. Allocating memory<a class="headerlink" href="#allocating-memory" title="Ссылка на этот заголовок">¶</a></h3>
<p>Prefer the supplied slab (salloc) and pool (palloc) allocators to malloc()/free()
for any performance-intensive or large  memory allocations. Repetitive use of
malloc()/free() can lead to memory fragmentation and should therefore be avoided.</p>
<p>Always free all allocated memory, even allocated  at start-up. We aim at being
valgrind leak-check clean, and in most cases it&#8217;s just as easy to free() the
allocated memory as it is to write a valgrind suppression. Freeing all allocated
memory is also dynamic-load friendly: assuming a plug-in can be dynamically loaded
and unloaded multiple times, reload should not lead to a memory leak.</p>
</div>
<div class="section" id="other">
<h3>4.3.1.4. Other<a class="headerlink" href="#other" title="Ссылка на этот заголовок">¶</a></h3>
<p>Select GNU C99 extensions are acceptable. It&#8217;s OK to mix declarations and statements,
use true and false.</p>
<p>The not-so-current list of all GCC C extensions can be found at:
<a class="reference external" href="http://gcc.gnu.org/onlinedocs/gcc-4.3.5/gcc/C-Extensions.html">http://gcc.gnu.org/onlinedocs/gcc-4.3.5/gcc/C-Extensions.html</a></p>
</div>
</div>
<div class="section" id="linux-kernel-coding-style">
<h2>4.3.2. Linux kernel coding style<a class="headerlink" href="#linux-kernel-coding-style" title="Ссылка на этот заголовок">¶</a></h2>
<p>This is a short document describing the preferred coding style for the
linux kernel.  Coding style is very personal, and I won&#8217;t _force_ my
views on anybody, but this is what goes for anything that I have to be
able to maintain, and I&#8217;d prefer it for most other things too.  Please
at least consider the points made here.</p>
<p>First off, I&#8217;d suggest printing out a copy of the GNU coding standards,
and NOT read it.  Burn them, it&#8217;s a great symbolic gesture.</p>
<p>Anyway, here goes:</p>
<div class="section" id="chapter-1-indentation">
<h3>4.3.2.1. Chapter 1: Indentation<a class="headerlink" href="#chapter-1-indentation" title="Ссылка на этот заголовок">¶</a></h3>
<p>Tabs are 8 characters, and thus indentations are also 8 characters.
There are heretic movements that try to make indentations 4 (or even 2!)
characters deep, and that is akin to trying to define the value of PI to
be 3.</p>
<p>Rationale: The whole idea behind indentation is to clearly define where
a block of control starts and ends.  Especially when you&#8217;ve been looking
at your screen for 20 straight hours, you&#8217;ll find it a lot easier to see
how the indentation works if you have large indentations.</p>
<p>Now, some people will claim that having 8-character indentations makes
the code move too far to the right, and makes it hard to read on a
80-character terminal screen.  The answer to that is that if you need
more than 3 levels of indentation, you&#8217;re screwed anyway, and should fix
your program.</p>
<p>In short, 8-char indents make things easier to read, and have the added
benefit of warning you when you&#8217;re nesting your functions too deep.
Heed that warning.</p>
<p>The preferred way to ease multiple indentation levels in a switch statement is
to align the &#8220;switch&#8221; and its subordinate &#8220;case&#8221; labels in the same column
instead of &#8220;double-indenting&#8221; the &#8220;case&#8221; labels. e.g.:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="sc">&#39;G&#39;</span><span class="o">:</span>
<span class="k">case</span> <span class="sc">&#39;g&#39;</span><span class="o">:</span>
    <span class="n">mem</span> <span class="o">&lt;&lt;=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="sc">&#39;M&#39;</span><span class="o">:</span>
<span class="k">case</span> <span class="sc">&#39;m&#39;</span><span class="o">:</span>
    <span class="n">mem</span> <span class="o">&lt;&lt;=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="sc">&#39;K&#39;</span><span class="o">:</span>
<span class="k">case</span> <span class="sc">&#39;k&#39;</span><span class="o">:</span>
    <span class="n">mem</span> <span class="o">&lt;&lt;=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="cm">/* fall through */</span>
<span class="k">default</span><span class="o">:</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Don&#8217;t put multiple statements on a single line unless you have
something to hide:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>if (condition) do_this;
  do_something_everytime;
</pre></div>
</div>
<p>Don&#8217;t put multiple assignments on a single line either. Kernel coding style
is super simple. Avoid tricky expressions.</p>
<p>Outside of comments, documentation and except in Kconfig, spaces are never
used for indentation, and the above example is deliberately broken.</p>
<p>Get a decent editor and don&#8217;t leave whitespace at the end of lines.</p>
</div>
<div class="section" id="chapter-2-breaking-long-lines-and-strings">
<h3>4.3.2.2. Chapter 2: Breaking long lines and strings<a class="headerlink" href="#chapter-2-breaking-long-lines-and-strings" title="Ссылка на этот заголовок">¶</a></h3>
<p>Coding style is all about readability and maintainability using commonly
available tools.</p>
<p>The limit on the length of lines is 80 columns and this is a strongly
preferred limit.</p>
<p>Statements longer than 80 columns will be broken into sensible chunks.
Descendants are always substantially shorter than the parent and are placed
substantially to the right. The same applies to function headers with a long
argument list. Long strings are as well broken into shorter strings. The
only exception to this is where exceeding 80 columns significantly increases
readability and does not hide information.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;Warning this is a long printk with &quot;</span>
                        <span class="s">&quot;3 parameters a: %u b: %u &quot;</span>
                        <span class="s">&quot;c: %u </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">next_statement</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="chapter-3-placing-braces-and-spaces">
<h3>4.3.2.3. Chapter 3: Placing Braces and Spaces<a class="headerlink" href="#chapter-3-placing-braces-and-spaces" title="Ссылка на этот заголовок">¶</a></h3>
<p>The other issue that always comes up in C styling is the placement of
braces.  Unlike the indent size, there are few technical reasons to
choose one placement strategy over the other, but the preferred way, as
shown to us by the prophets Kernighan and Ritchie, is to put the opening
brace last on the line, and put the closing brace first, thusly:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>if (x is true) {
    we do y
}
</pre></div>
</div>
<p>This applies to all non-function statement blocks (if, switch, for,
while, do). e.g.:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="nl">KOBJ_ADD</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">&quot;add&quot;</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">KOBJ_REMOVE</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">&quot;remove&quot;</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">KOBJ_CHANGE</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">&quot;change&quot;</span><span class="p">;</span>
<span class="k">default</span><span class="o">:</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">function</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">body</span> <span class="n">of</span> <span class="n">function</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Heretic people all over the world have claimed that this inconsistency
is ...  well ...  inconsistent, but all right-thinking people know that
(a) K&amp;R are _right_ and (b) K&amp;R are right.  Besides, functions are
special anyway (you can&#8217;t nest them in C).</p>
<p>Note that the closing brace is empty on a line of its own, _except_ in
the cases where it is followed by a continuation of the same statement,
ie a &#8220;while&#8221; in a do-statement or an &#8220;else&#8221; in an if-statement, like
this:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">do</span> <span class="p">{</span>
    <span class="n">body</span> <span class="n">of</span> <span class="k">do</span><span class="o">-</span><span class="n">loop</span><span class="p">;</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">condition</span><span class="p">);</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">..</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="p">....</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Rationale: K&amp;R.</p>
<p>Also, note that this brace-placement also minimizes the number of empty
(or almost empty) lines, without any loss of readability.  Thus, as the
supply of new-lines on your screen is not a renewable resource (think
25-line terminal screens here), you have more empty lines to put
comments on.</p>
<p>Do not unnecessarily use braces where a single statement will do.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span>
    <span class="n">action</span><span class="p">();</span>
</pre></div>
</div>
<p>This does not apply if one branch of a conditional statement is a single
statement. Use braces in both branches.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">do_this</span><span class="p">();</span>
    <span class="n">do_that</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">otherwise</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="chapter-3-1-spaces">
<h3>4.3.2.4. Chapter 3.1:  Spaces<a class="headerlink" href="#chapter-3-1-spaces" title="Ссылка на этот заголовок">¶</a></h3>
<p>Linux kernel style for use of spaces depends (mostly) on
function-versus-keyword usage.  Use a space after (most) keywords.  The
notable exceptions are sizeof, typeof, alignof, and __attribute__, which look
somewhat like functions (and are usually used with parentheses in Linux,
although they are not required in the language, as in: &#8220;sizeof info&#8221; after
&#8220;struct fileinfo info;&#8221; is declared).</p>
<p>So use a space after these keywords: if, switch, case, for, do, while
but not with sizeof, typeof, alignof, or __attribute__.  E.g.,</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span><span class="p">);</span>
</pre></div>
</div>
<p>Do not add spaces around (inside) parenthesized expressions. This example is
<strong>bad</strong>:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span> <span class="k">struct</span> <span class="n">file</span> <span class="p">);</span>
</pre></div>
</div>
<p>When declaring pointer data or a function that returns a pointer type, the
preferred use of &#8216;*&#8217; is adjacent to the data name or function name and not
adjacent to the type name.  Examples:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">linux_banner</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="nf">memparse</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">retptr</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">match_strdup</span><span class="p">(</span><span class="n">substring_t</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<p>Use one space around (on each side of) most binary and ternary operators,
such as any of these:</p>
<blockquote>
<div>=  +  -  &lt;  &gt;  *  /  %  |  &amp;  ^  &lt;=  &gt;=  ==  !=  ?  :</div></blockquote>
<p>but no space after unary operators:</p>
<blockquote>
<div>&amp;  *  +  -  ~  !  sizeof  typeof  alignof  __attribute__  defined</div></blockquote>
<p>no space before the postfix increment &amp; decrement unary operators:</p>
<blockquote>
<div>++  &#8211;</div></blockquote>
<p>no space after the prefix increment &amp; decrement unary operators:</p>
<blockquote>
<div>++  &#8211;</div></blockquote>
<p>and no space around the &#8216;.&#8217; and &#8220;-&gt;&#8221; structure member operators.</p>
<p>Do not leave trailing whitespace at the ends of lines.  Some editors with
&#8220;smart&#8221; indentation will insert whitespace at the beginning of new lines as
appropriate, so you can start typing the next line of code right away.
However, some such editors do not remove the whitespace if you end up not
putting a line of code there, such as if you leave a blank line.  As a result,
you end up with lines containing trailing whitespace.</p>
<p>Git will warn you about patches that introduce trailing whitespace, and can
optionally strip the trailing whitespace for you; however, if applying a series
of patches, this may make later patches in the series fail by changing their
context lines.</p>
</div>
<div class="section" id="chapter-4-naming">
<h3>4.3.2.5. Chapter 4: Naming<a class="headerlink" href="#chapter-4-naming" title="Ссылка на этот заголовок">¶</a></h3>
<p>C is a Spartan language, and so should your naming be.  Unlike Modula-2
and Pascal programmers, C programmers do not use cute names like
ThisVariableIsATemporaryCounter.  A C programmer would call that
variable &#8220;tmp&#8221;, which is much easier to write, and not the least more
difficult to understand.</p>
<p>HOWEVER, while mixed-case names are frowned upon, descriptive names for
global variables are a must.  To call a global function &#8220;foo&#8221; is a
shooting offense.</p>
<p>GLOBAL variables (to be used only if you _really_ need them) need to
have descriptive names, as do global functions.  If you have a function
that counts the number of active users, you should call that
&#8220;count_active_users()&#8221; or similar, you should _not_ call it &#8220;cntusr()&#8221;.</p>
<p>Encoding the type of a function into the name (so-called Hungarian
notation) is brain damaged - the compiler knows the types anyway and can
check those, and it only confuses the programmer.  No wonder MicroSoft
makes buggy programs.</p>
<p>LOCAL variable names should be short, and to the point.  If you have
some random integer loop counter, it should probably be called &#8220;i&#8221;.
Calling it &#8220;loop_counter&#8221; is non-productive, if there is no chance of it
being mis-understood.  Similarly, &#8220;tmp&#8221; can be just about any type of
variable that is used to hold a temporary value.</p>
<p>If you are afraid to mix up your local variable names, you have another
problem, which is called the function-growth-hormone-imbalance syndrome.
See chapter 6 (Functions).</p>
</div>
<div class="section" id="chapter-5-typedefs">
<h3>4.3.2.6. Chapter 5: Typedefs<a class="headerlink" href="#chapter-5-typedefs" title="Ссылка на этот заголовок">¶</a></h3>
<p>Please don&#8217;t use things like &#8220;vps_t&#8221;.</p>
<p>It&#8217;s a _mistake_ to use typedef for structures and pointers. When you see a</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">vps_t</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
<p>in the source, what does it mean?</p>
<p>In contrast, if it says</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">virtual_container</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
<p>you can actually tell what &#8220;a&#8221; is.</p>
<p>Lots of people think that typedefs &#8220;help readability&#8221;. Not so. They are
useful only for:</p>
<ol class="loweralpha">
<li><p class="first">totally opaque objects (where the typedef is actively used to _hide_
what the object is).</p>
<p>Example: &#8220;pte_t&#8221; etc. opaque objects that you can only access using
the proper accessor functions.</p>
<p>NOTE! Opaqueness and &#8220;accessor functions&#8221; are not good in themselves.
The reason we have them for things like pte_t etc. is that there
really is absolutely _zero_ portably accessible information there.</p>
</li>
<li><p class="first">Clear integer types, where the abstraction _helps_ avoid confusion
whether it is &#8220;int&#8221; or &#8220;long&#8221;.</p>
<p>u8/u16/u32 are perfectly fine typedefs, although they fit into
category (d) better than here.</p>
<p>NOTE! Again - there needs to be a _reason_ for this. If something is
&#8220;unsigned long&#8221;, then there&#8217;s no reason to do</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">myflags_t</span><span class="p">;</span>
</pre></div>
</div>
<p>but if there is a clear reason for why it under certain circumstances
might be an &#8220;unsigned int&#8221; and under other configurations might be
&#8220;unsigned long&#8221;, then by all means go ahead and use a typedef.</p>
</li>
<li><p class="first">when you use sparse to literally create a _new_ type for
type-checking.</p>
</li>
<li><p class="first">New types which are identical to standard C99 types, in certain
exceptional circumstances.</p>
<p>Although it would only take a short amount of time for the eyes and
brain to become accustomed to the standard types like &#8216;uint32_t&#8217;,
some people object to their use anyway.</p>
<p>Therefore, the Linux-specific &#8216;u8/u16/u32/u64&#8217; types and their
signed equivalents which are identical to standard types are
permitted &#8211; although they are not mandatory in new code of your
own.</p>
<p>When editing existing code which already uses one or the other set
of types, you should conform to the existing choices in that code.</p>
</li>
<li><p class="first">Types safe for use in userspace.</p>
<p>In certain structures which are visible to userspace, we cannot
require C99 types and cannot use the &#8216;u32&#8217; form above. Thus, we
use __u32 and similar types in all structures which are shared
with userspace.</p>
</li>
</ol>
<p>Maybe there are other cases too, but the rule should basically be to NEVER
EVER use a typedef unless you can clearly match one of those rules.</p>
<p>In general, a pointer, or a struct that has elements that can reasonably
be directly accessed should <strong>never</strong> be a typedef.</p>
</div>
<div class="section" id="chapter-6-functions">
<h3>4.3.2.7. Chapter 6: Functions<a class="headerlink" href="#chapter-6-functions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Functions should be short and sweet, and do just one thing.  They should
fit on one or two screenfuls of text (the ISO/ANSI screen size is 80x24,
as we all know), and do one thing and do that well.</p>
<p>The maximum length of a function is inversely proportional to the
complexity and indentation level of that function.  So, if you have a
conceptually simple function that is just one long (but simple)
case-statement, where you have to do lots of small things for a lot of
different cases, it&#8217;s OK to have a longer function.</p>
<p>However, if you have a complex function, and you suspect that a
less-than-gifted first-year high-school student might not even
understand what the function is all about, you should adhere to the
maximum limits all the more closely.  Use helper functions with
descriptive names (you can ask the compiler to in-line them if you think
it&#8217;s performance-critical, and it will probably do a better job of it
than you would have done).</p>
<p>Another measure of the function is the number of local variables.  They
shouldn&#8217;t exceed 5-10, or you&#8217;re doing something wrong.  Re-think the
function, and split it into smaller pieces.  A human brain can
generally easily keep track of about 7 different things, anything more
and it gets confu/sed.  You know you&#8217;re brilliant, but maybe you&#8217;d like
to understand what you did 2 weeks from now.</p>
<p>In source files, separate functions with one blank line.  If the function is
exported, the EXPORT* macro for it should follow immediately after the closing
function brace line.  E.g.:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">system_is_up</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">system_state</span> <span class="o">==</span> <span class="n">SYSTEM_RUNNING</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">system_is_up</span><span class="p">);</span>
</pre></div>
</div>
<p>In function prototypes, include parameter names with their data types.
Although this is not required by the C language, it is preferred in Linux
because it is a simple way to add valuable information for the reader.</p>
</div>
<div class="section" id="chapter-7-centralized-exiting-of-functions">
<h3>4.3.2.8. Chapter 7: Centralized exiting of functions<a class="headerlink" href="#chapter-7-centralized-exiting-of-functions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Albeit deprecated by some people, the equivalent of the goto statement is
used frequently by compilers in form of the unconditional jump instruction.</p>
<p>The goto statement comes in handy when a function exits from multiple
locations and some common work such as cleanup has to be done.</p>
<p>The rationale is:</p>
<ul class="simple">
<li>unconditional statements are easier to understand and follow</li>
<li>nesting is reduced</li>
<li>errors by not updating individual exit points when making
modifications are prevented</li>
<li>saves the compiler work to optimize redundant code away ;)</li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">SIZE</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">condition1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">loop1</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="nl">out</span><span class="p">:</span>
    <span class="n">kfree</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="chapter-8-commenting">
<h3>4.3.2.9. Chapter 8: Commenting<a class="headerlink" href="#chapter-8-commenting" title="Ссылка на этот заголовок">¶</a></h3>
<p>Comments are good, but there is also a danger of over-commenting. NEVER
try to explain HOW your code works in a comment: it&#8217;s much better to
write the code so that the _working_ is obvious, and it&#8217;s a waste of
time to explain badly written code.
с
Generally, you want your comments to tell WHAT your code does, not HOW.
Also, try to avoid putting comments inside a function body: if the
function is so complex that you need to separately comment parts of it,
you should probably go back to chapter 6 for a while.  You can make
small comments to note or warn about something particularly clever (or
ugly), but try to avoid excess.  Instead, put the comments at the head
of the function, telling people what it does, and possibly WHY it does
it.</p>
<p>When commenting the kernel API functions, please use the kernel-doc format.
See the files Documentation/kernel-doc-nano-HOWTO.txt and scripts/kernel-doc
for details.</p>
<p>Linux style for comments is the C89 <code class="docutils literal"><span class="pre">&quot;/\*</span> <span class="pre">...</span> <span class="pre">\*/&quot;</span></code> style.
Don&#8217;t use C99-style <code class="docutils literal"><span class="pre">&quot;//</span> <span class="pre">...&quot;</span></code> comments.</p>
<p>The preferred style for long (multi-line) comments is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * This is the preferred style for multi-line</span>
<span class="cm"> * comments in the Linux kernel source code.</span>
<span class="cm"> * Please use it consistently.</span>
<span class="cm"> *</span>
<span class="cm"> * Description:  A column of asterisks on the left side,</span>
<span class="cm"> * with beginning and ending almost-blank lines.</span>
<span class="cm"> */</span>
</pre></div>
</div>
<p>It&#8217;s also important to comment data, whether they are basic types or derived
types.  To this end, use just one data declaration per line (no commas for
multiple data declarations).  This leaves you room for a small comment on each
item, explaining its use.</p>
</div>
<div class="section" id="chapter-9-you-ve-made-a-mess-of-it">
<h3>4.3.2.10. Chapter 9: You&#8217;ve made a mess of it<a class="headerlink" href="#chapter-9-you-ve-made-a-mess-of-it" title="Ссылка на этот заголовок">¶</a></h3>
<p>That&#8217;s OK, we all do.  You&#8217;ve probably been told by your long-time Unix
user helper that &#8220;GNU emacs&#8221; automatically formats the C sources for
you, and you&#8217;ve noticed that yes, it does do that, but the defaults it
uses are less than desirable (in fact, they are worse than random
typing - an infinite number of monkeys typing into GNU emacs would never
make a good program).</p>
<p>So, you can either get rid of GNU emacs, or change it to use saner
values.  To do the latter, you can stick the following in your .emacs file:</p>
<div class="highlight-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">c-lineup-arglist-tabs-only</span> <span class="p">(</span><span class="nv">ignored</span><span class="p">)</span>
<span class="s">&quot;Line up argument lists by tabs, not spaces&quot;</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">anchor</span> <span class="p">(</span><span class="nv">c-langelem-pos</span> <span class="nv">c-syntactic-element</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">column</span> <span class="p">(</span><span class="nv">c-langelem-2nd-pos</span> <span class="nv">c-syntactic-element</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">offset</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">column</span><span class="p">)</span> <span class="nv">anchor</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">steps</span> <span class="p">(</span><span class="nb">floor</span> <span class="nv">offset</span> <span class="nv">c-basic-offset</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">max</span> <span class="nv">steps</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">c-basic-offset</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-common-hook</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="c1">;; Add kernel style</span>
            <span class="p">(</span><span class="nv">c-add-style</span>
            <span class="s">&quot;linux-tabs-only&quot;</span>
            <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;linux&quot;</span> <span class="p">(</span><span class="nv">c-offsets-alist</span>
                        <span class="p">(</span><span class="nv">arglist-cont-nonempty</span>
                        <span class="nv">c-lineup-gcc-asm-reg</span>
                        <span class="nv">c-lineup-arglist-tabs-only</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;c-mode-hook</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">filename</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)))</span>
            <span class="c1">;; Enable kernel mode for the appropriate files</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">filename</span>
                        <span class="p">(</span><span class="nv">string-match</span> <span class="p">(</span><span class="nv">expand-file-name</span> <span class="s">&quot;~/src/linux-trees&quot;</span><span class="p">)</span>
                                    <span class="nv">filename</span><span class="p">))</span>
                <span class="p">(</span><span class="k">setq</span> <span class="nv">indent-tabs-mode</span> <span class="no">t</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">c-set-style</span> <span class="s">&quot;linux-tabs-only&quot;</span><span class="p">)))))</span>
</pre></div>
</div>
<p>This will make emacs go better with the kernel coding style for C
files below ~/src/linux-trees.</p>
<p>But even if you fail in getting emacs to do sane formatting, not
everything is lost: use &#8220;indent&#8221;.</p>
<p>Now, again, GNU indent has the same brain-dead settings that GNU emacs
has, which is why you need to give it a few command line options.
However, that&#8217;s not too bad, because even the makers of GNU indent
recognize the authority of K&amp;R (the GNU people aren&#8217;t evil, they are
just severely misguided in this matter), so you just give indent the
options &#8220;-kr -i8&#8221; (stands for &#8220;K&amp;R, 8 character indents&#8221;), or use
&#8220;scripts/Lindent&#8221;, which indents in the latest style.</p>
<p>&#8220;indent&#8221; has a lot of options, and especially when it comes to comment
re-formatting you may want to take a look at the man page.  But
remember: &#8220;indent&#8221; is not a fix for bad programming.</p>
</div>
<div class="section" id="chapter-10-kconfig-configuration-files">
<h3>4.3.2.11. Chapter 10: Kconfig configuration files<a class="headerlink" href="#chapter-10-kconfig-configuration-files" title="Ссылка на этот заголовок">¶</a></h3>
<p>For all of the Kconfig* configuration files throughout the source tree,
the indentation is somewhat different.  Lines under a &#8220;config&#8221; definition
are indented with one tab, while help text is indented an additional two
spaces. Example:</p>
<div class="highlight-kconfig"><div class="highlight"><pre><span></span><span class="k">config</span> AUDIT
    <span class="nb">bool</span> <span class="s2">&quot;Auditing support&quot;</span>
    <span class="k">depends on</span> NET
    <span class="k">help</span>
    Enable auditing infrastructure that can be used with another
    kernel subsystem, such as SELinux <span class="p">(</span>which requires this for
    logging of avc messages output).  Does not do system-call
    auditing without CONFIG_AUDITSYSCALL.
</pre></div>
</div>
<p>Features that might still be considered unstable should be defined as
dependent on &#8220;EXPERIMENTAL&#8221;:</p>
<div class="highlight-kconfig"><div class="highlight"><pre><span></span><span class="k">config</span> SLUB
    <span class="k">depends on</span> EXPERIMENTAL <span class="o">&amp;&amp;</span> <span class="o">!</span>ARCH_USES_SLAB_PAGE_STRUCT
    <span class="nb">bool</span> <span class="s2">&quot;SLUB (Unqueued Allocator)&quot;</span>
    ...
</pre></div>
</div>
<p>while seriously dangerous features (such as write support for certain
filesystems) should advertise this prominently in their prompt string:</p>
<div class="highlight-kconfig"><div class="highlight"><pre><span></span><span class="k">config</span> ADFS_FS_RW
    <span class="nb">bool</span> <span class="s2">&quot;ADFS write support (DANGEROUS)&quot;</span>
    <span class="k">depends on</span> ADFS_FS
    ...
</pre></div>
</div>
<p>For full documentation on the configuration files, see the file
Documentation/kbuild/kconfig-language.txt.</p>
</div>
<div class="section" id="chapter-11-data-structures">
<h3>4.3.2.12. Chapter 11: Data structures<a class="headerlink" href="#chapter-11-data-structures" title="Ссылка на этот заголовок">¶</a></h3>
<p>Data structures that have visibility outside the single-threaded
environment they are created and destroyed in should always have
reference counts.  In the kernel, garbage collection doesn&#8217;t exist (and
outside the kernel garbage collection is slow and inefficient), which
means that you absolutely _have_ to reference count all your uses.</p>
<p>Reference counting means that you can avoid locking, and allows multiple
users to have access to the data structure in parallel - and not having
to worry about the structure suddenly going away from under them just
because they slept or did something else for a while.</p>
<p>Note that locking is _not_ a replacement for reference counting.
Locking is used to keep data structures coherent, while reference
counting is a memory management technique.  Usually both are needed, and
they are not to be confused with each other.</p>
<p>Many data structures can indeed have two levels of reference counting,
when there are users of different &#8220;classes&#8221;.  The subclass count counts
the number of subclass users, and decrements the global count just once
when the subclass count goes to zero.</p>
<p>Examples of this kind of &#8220;multi-level-reference-counting&#8221; can be found in
memory management (&#8220;struct mm_struct&#8221;: mm_users and mm_count), and in
filesystem code (&#8220;struct super_block&#8221;: s_count and s_active).</p>
<p>Remember: if another thread can find your data structure, and you don&#8217;t
have a reference count on it, you almost certainly have a bug.</p>
</div>
<div class="section" id="chapter-12-macros-enums-and-rtl">
<h3>4.3.2.13. Chapter 12: Macros, Enums and RTL<a class="headerlink" href="#chapter-12-macros-enums-and-rtl" title="Ссылка на этот заголовок">¶</a></h3>
<p>Names of macros defining constants and labels in enums are capitalized.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define CONSTANT 0x12345</span>
</pre></div>
</div>
<p>Enums are preferred when defining several related constants.</p>
<p>CAPITALIZED macro names are appreciated but macros resembling functions
may be named in lower case.</p>
<p>Generally, inline functions are preferable to macros resembling functions.</p>
<p>Macros with multiple statements should be enclosed in a do - while block:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define macrofun(a, b, c)   \</span>
<span class="cp">    do {                    \</span>
<span class="cp">        if (a == 5)         \</span>
<span class="cp">            do_this(b, c);  \</span>
<span class="cp">    } while (0)</span>
</pre></div>
</div>
<p>Things to avoid when using macros:</p>
<ol class="arabic">
<li><p class="first">macros that affect control flow:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define FOO(x)                  \</span>
<span class="cp">    do {                        \</span>
<span class="cp">        if (blah(x) &lt; 0)        \</span>
<span class="cp">            return -EBUGGERED;  \</span>
<span class="cp">    } while(0)</span>
</pre></div>
</div>
<p>is a _very_ bad idea.  It looks like a function call but exits the &#8220;calling&#8221;
function; don&#8217;t break the internal parsers of those who will read the code.</p>
</li>
<li><p class="first">macros that depend on having a local variable with a magic name:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define FOO(val) bar(index, val)</span>
</pre></div>
</div>
<p>might look like a good thing, but it&#8217;s confusing as hell when one reads the
code and it&#8217;s prone to breakage from seemingly innocent changes.</p>
</li>
<li><p class="first">macros with arguments that are used as l-values: FOO(x) = y; will
bite you if somebody e.g. turns FOO into an inline function.</p>
</li>
<li><p class="first">forgetting about precedence: macros defining constants using expressions
must enclose the expression in parentheses. Beware of similar issues with
macros using parameters.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define CONSTANT 0x4000</span>
<span class="cp">#define CONSTEXP (CONSTANT | 3)</span>
</pre></div>
</div>
<p>The cpp manual deals with macros exhaustively. The gcc internals manual also
covers RTL which is used frequently with assembly language in the kernel.</p>
</li>
</ol>
</div>
<div class="section" id="chapter-13-printing-kernel-messages">
<h3>4.3.2.14. Chapter 13: Printing kernel messages<a class="headerlink" href="#chapter-13-printing-kernel-messages" title="Ссылка на этот заголовок">¶</a></h3>
<p>Kernel developers like to be seen as literate. Do mind the spelling
of kernel messages to make a good impression. Do not use crippled
words like &#8220;dont&#8221;; use &#8220;do not&#8221; or &#8220;don&#8217;t&#8221; instead.  Make the messages
concise, clear, and unambiguous.</p>
<p>Kernel messages do not have to be terminated with a period.</p>
<p>Printing numbers in parentheses (%d) adds no value and should be avoided.</p>
<p>There are a number of driver model diagnostic macros in &lt;linux/device.h&gt;
which you should use to make sure messages are matched to the right device
and driver, and are tagged with the right level:  dev_err(), dev_warn(),
dev_info(), and so forth.  For messages that aren&#8217;t associated with a
particular device, &lt;linux/kernel.h&gt; defines pr_debug() and pr_info().</p>
<p>Coming up with good debugging messages can be quite a challenge; and once
you have them, they can be a huge help for remote troubleshooting.  Such
messages should be compiled out when the DEBUG symbol is not defined (that
is, by default they are not included).  When you use dev_dbg() or pr_debug(),
that&#8217;s automatic.  Many subsystems have Kconfig options to turn on -DDEBUG.
A related convention uses VERBOSE_DEBUG to add dev_vdbg() messages to the
ones already enabled by DEBUG.</p>
</div>
<div class="section" id="chapter-14-allocating-memory">
<h3>4.3.2.15. Chapter 14: Allocating memory<a class="headerlink" href="#chapter-14-allocating-memory" title="Ссылка на этот заголовок">¶</a></h3>
<p>The kernel provides the following general purpose memory allocators:
kmalloc(), kzalloc(), kcalloc(), and vmalloc().  Please refer to the API
documentation for further information about them.</p>
<p>The preferred form for passing a size of a struct is the following:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">),</span> <span class="p">...);</span>
</pre></div>
</div>
<p>The alternative form where struct name is spelled out hurts readability and
introduces an opportunity for a bug when the pointer variable type is changed
but the corresponding sizeof that is passed to a memory allocator is not.</p>
<p>Casting the return value which is a void pointer is redundant. The conversion
from void pointer to any other pointer type is guaranteed by the C programming
language.</p>
</div>
<div class="section" id="chapter-15-the-inline-disease">
<h3>4.3.2.16. Chapter 15: The inline disease<a class="headerlink" href="#chapter-15-the-inline-disease" title="Ссылка на этот заголовок">¶</a></h3>
<p>There appears to be a common misperception that gcc has a magic &#8220;make me
faster&#8221; speedup option called &#8220;inline&#8221;. While the use of inlines can be
appropriate (for example as a means of replacing macros, see Chapter 12), it
very often is not. Abundant use of the inline keyword leads to a much bigger
kernel, which in turn slows the system as a whole down, due to a bigger
icache footprint for the CPU and simply because there is less memory
available for the pagecache. Just think about it; a pagecache miss causes a
disk seek, which easily takes 5 milliseconds. There are a LOT of cpu cycles
that can go into these 5 milliseconds.</p>
<p>A reasonable rule of thumb is to not put inline at functions that have more
than 3 lines of code in them. An exception to this rule are the cases where
a parameter is known to be a compiletime constant, and as a result of this
constantness you <em>know</em> the compiler will be able to optimize most of your
function away at compile time. For a good example of this later case, see
the kmalloc() inline function.</p>
<p>Often people argue that adding inline to functions that are static and used
only once is always a win since there is no space tradeoff. While this is
technically correct, gcc is capable of inlining these automatically without
help, and the maintenance issue of removing the inline when a second user
appears outweighs the potential value of the hint that tells gcc to do
something it would have done anyway.</p>
</div>
<div class="section" id="chapter-16-function-return-values-and-names">
<h3>4.3.2.17. Chapter 16: Function return values and names<a class="headerlink" href="#chapter-16-function-return-values-and-names" title="Ссылка на этот заголовок">¶</a></h3>
<p>Functions can return values of many different kinds, and one of the
most common is a value indicating whether the function succeeded or
failed.  Such a value can be represented as an error-code integer
(-Exxx = failure, 0 = success) or a &#8220;succeeded&#8221; boolean (0 = failure,
non-zero = success).</p>
<p>Mixing up these two sorts of representations is a fertile source of
difficult-to-find bugs.  If the C language included a strong distinction
between integers and booleans then the compiler would find these mistakes
for us... but it doesn&#8217;t.  To help prevent such bugs, always follow this
convention:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">a</span> <span class="n">function</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">action</span> <span class="ow">or</span> <span class="n">an</span> <span class="n">imperative</span> <span class="n">command</span><span class="p">,</span>
<span class="n">the</span> <span class="n">function</span> <span class="n">should</span> <span class="k">return</span> <span class="n">an</span> <span class="n">error</span><span class="o">-</span><span class="n">code</span> <span class="n">integer</span><span class="o">.</span>  <span class="n">If</span> <span class="n">the</span> <span class="n">name</span>
<span class="ow">is</span> <span class="n">a</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">the</span> <span class="n">function</span> <span class="n">should</span> <span class="k">return</span> <span class="n">a</span> <span class="s2">&quot;succeeded&quot;</span> <span class="n">boolean</span><span class="o">.</span>
</pre></div>
</div>
<p>For example, &#8220;add work&#8221; is a command, and the add_work() function returns 0
for success or -EBUSY for failure.  In the same way, &#8220;PCI device present&#8221; is
a predicate, and the pci_dev_present() function returns 1 if it succeeds in
finding a matching device or 0 if it doesn&#8217;t.</p>
<p>All EXPORTed functions must respect this convention, and so should all
public functions.  Private (static) functions need not, but it is
recommended that they do.</p>
<p>Functions whose return value is the actual result of a computation, rather
than an indication of whether the computation succeeded, are not subject to
this rule.  Generally they indicate failure by returning some out-of-range
result.  Typical examples would be functions that return pointers; they use
NULL or the ERR_PTR mechanism to report failure.</p>
</div>
<div class="section" id="chapter-17-don-t-re-invent-the-kernel-macros">
<h3>4.3.2.18. Chapter 17:  Don&#8217;t re-invent the kernel macros<a class="headerlink" href="#chapter-17-don-t-re-invent-the-kernel-macros" title="Ссылка на этот заголовок">¶</a></h3>
<p>The header file include/linux/kernel.h contains a number of macros that
you should use, rather than explicitly coding some variant of them yourself.
For example, if you need to calculate the length of an array, take advantage
of the macro</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))</span>
</pre></div>
</div>
<p>Similarly, if you need to calculate the size of some structure member, use</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define FIELD_SIZEOF(t, f) (sizeof(((t*)0)-&gt;f))</span>
</pre></div>
</div>
<p>There are also min() and max() macros that do strict type checking if you
need them.  Feel free to peruse that header file to see what else is already
defined that you shouldn&#8217;t reproduce in your code.</p>
</div>
<div class="section" id="chapter-18-editor-modelines-and-other-cruft">
<h3>4.3.2.19. Chapter 18:  Editor modelines and other cruft<a class="headerlink" href="#chapter-18-editor-modelines-and-other-cruft" title="Ссылка на этот заголовок">¶</a></h3>
<p>Some editors can interpret configuration information embedded in source files,
indicated with special markers.  For example, emacs interprets lines marked
like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>-*- mode: c -*-
</pre></div>
</div>
<p>Or like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/*
Local Variables:
compile-command: &quot;gcc -DMAGIC_DEBUG_FLAG foo.c&quot;
End:
*/
</pre></div>
</div>
<p>Vim interprets markers that look like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/* vim:set sw=8 noet */
</pre></div>
</div>
<p>Do not include any of these in source files.  People have their own personal
editor configurations, and your source files should not override them.  This
includes markers for indentation and mode configuration.  People may use their
own custom mode, or may have some other magic method for making indentation
work correctly.</p>
</div>
<div class="section" id="appendix-i-references">
<h3>4.3.2.20. Appendix I: References<a class="headerlink" href="#appendix-i-references" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/The_C_Programming_Language">The C Programming Language, Second Edition</a>
by Brian W. Kernighan and Dennis M. Ritchie. <br />
Prentice Hall, Inc., 1988. <br />
ISBN 0-13-110362-8 (paperback), 0-13-110370-9 (hardback).</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/The_Practice_of_Programming">The Practice of Programming</a>
by Brian W. Kernighan and Rob Pike. <br />
Addison-Wesley, Inc., 1999. <br />
ISBN 0-201-61586-X.</li>
<li><a class="reference external" href="http://www.gnu.org/manual/">GNU manuals</a> - where in compliance with K&amp;R and this text - for <strong>cpp</strong>, <strong>gcc</strong>,
<strong>gcc internals</strong> and <strong>indent</strong></li>
<li><a class="reference external" href="http://www.open-std.org/JTC1/SC22/WG14/">WG14 International standardization workgroup for the programming
language C</a></li>
<li><a class="reference external" href="http://www.kroah.com/linux/talks/ols_2002_kernel_codingstyle_talk/html/">Kernel CodingStyle, by greg&#64;kroah.com at OLS 2002</a></li>
</ul>
</div>
</div>
</div>

  </article>

            
            
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="documentation_guidelines.html"
           class="b-prev b-ellipsis"
           title="4.2. Documentation guidelines">4.2. Documentation guidelines</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../../_sources/doc/dev_guide/c_style_guide.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="python_style_guide.html"
           class="b-next b-ellipsis"
           title="4.4. Python Style Guide">4.4. Python Style Guide</a>
      </div>
    
    </div>
  
</div>
        </div>
      </div>
    
  

      </div>
    </div>
    <!-- FOOTER > -->
    
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

    <!-- < FOOTER -->
    <div id="mobile-checker"></div>
  </body>
</html>

